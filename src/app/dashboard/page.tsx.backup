"use client";

import { useState, useEffect } from "react";
import { useAuth } from "@/contexts/AuthContext";
import { useNotifications } from "@/contexts/NotificationContext";
import { useRouter } from "next/navigation";
import ReminderModal from "@/components/reminder/ReminderModal";
import ReminderCard from "@/components/reminder/ReminderCard";
import TaskCard from "@/components/task/TaskCard";
import Calendar from "@/components/calendar/Calendar";
import TimerWidget from "@/components/timer/TimerWidget";
import { Reminder } from "@/types/reminder";
import { Task, TaskWithSubject, TaskStats } from "@/types/task";
import { getUpcomingReminders } from "@/lib/reminders";
import { getTaskStats, getUpcomingTasks, updateOverdueTasks, toggleTaskCompletion } from "@/lib/tasks";
import { getUserSubjects, getUserStorageUsage } from "@/lib/storage";
import { Subject, SubjectWithFileCount } from "@/types/subject";

export default function DashboardPage() {
  const { user, logout } = useAuth();
  const { setUpcomingReminders: setGlobalReminders, setUpcomingTasks: setGlobalTasks } = useNotifications();
  const router = useRouter();
  const [upcomingReminders, setLocalUpcomingReminders] = useState<Reminder[]>([]);
  const [upcomingTasks, setLocalUpcomingTasks] = useState<TaskWithSubject[]>([]);
  const [taskStats, setTaskStats] = useState<TaskStats>({
    total: 0,
    pending: 0,
    completed: 0,
    overdue: 0,
    dueThisWeek: 0
  });
  const [subjects, setSubjects] = useState<Subject[]>([]);
  const [recentFileCount, setRecentFileCount] = useState(0);
  const [isReminderModalOpen, setIsReminderModalOpen] = useState(false);
  const [isLoadingReminders, setIsLoadingReminders] = useState(true);
  const [isLoadingTasks, setIsLoadingTasks] = useState(true);
  const [isLoadingData, setIsLoadingData] = useState(true);

  const handleSignOut = async () => {
    try {
      await logout();
      router.push("/login");
    } catch (error) {
}
  };

  useEffect(() => {
    if (user) {
      loadUpcomingReminders();
      loadUpcomingTasks();
      loadTaskStats();
      loadUserData();
    }
  }, [user]);

  const loadUpcomingReminders = async () => {
    if (!user) return;

    setIsLoadingReminders(true);
    try {
      const reminders = await getUpcomingReminders(user.userId);
      const limitedReminders = reminders.slice(0, 3); // Show only 3 upcoming reminders
      setLocalUpcomingReminders(limitedReminders);
      setGlobalReminders(limitedReminders); // Update global context for notifications
    } catch (error) {
} finally {
      setIsLoadingReminders(false);
    }
  };

  const loadUpcomingTasks = async () => {
    if (!user) return;

    setIsLoadingTasks(true);
    try {
      // Update overdue tasks first
      await updateOverdueTasks(user.userId);

      const [tasks, userSubjects] = await Promise.all([
        getUpcomingTasks(user.userId, 5), // Show only 5 upcoming tasks
        getUserSubjects(user.userId)
      ]);

      // Attach subject information to tasks
      const tasksWithSubjects = tasks.map(task => ({
        ...task,
        subject: task.subjectId ? userSubjects.find(s => s.id === task.subjectId) : undefined
      }));

      setLocalUpcomingTasks(tasksWithSubjects);
      setGlobalTasks(tasksWithSubjects); // Update global context for notifications
    } catch (error) {
} finally {
      setIsLoadingTasks(false);
    }
  };

  const loadTaskStats = async () => {
    if (!user) return;

    try {
      const stats = await getTaskStats(user.userId);
      setTaskStats(stats);
    } catch (error) {
}
  };

  const loadUserData = async () => {
    if (!user) return;

    setIsLoadingData(true);
    try {
      const [userSubjects, storageUsage] = await Promise.all([
        getUserSubjects(user.userId),
        getUserStorageUsage(user.userId)
      ]);

      setSubjects(userSubjects);
      setRecentFileCount(storageUsage > 0 ? 1 : 0); // Simplified - just show if any files exist
    } catch (error) {
} finally {
      setIsLoadingData(false);
    }
  };

  const handleReminderUpdate = (updatedReminder: Reminder) => {
    setLocalUpcomingReminders(prev =>
      prev.map(r => r.id === updatedReminder.id ? updatedReminder : r)
    );
    setGlobalReminders(prev =>
      prev.map(r => r.id === updatedReminder.id ? updatedReminder : r)
    );
  };

  const handleReminderDelete = (reminderId: string) => {
    setLocalUpcomingReminders(prev => prev.filter(r => r.id !== reminderId));
    setGlobalReminders(prev => prev.filter(r => r.id !== reminderId));
  };

  const handleTaskToggleComplete = async (taskId: string) => {
    if (!user?.userId) return;

    try {
      const updatedTask = await toggleTaskCompletion(user.userId, taskId);
      setLocalUpcomingTasks(prev =>
        prev.map(task =>
          task.id === taskId
            ? {
                ...task,
                status: updatedTask.status
              }
            : task
        )
      );

      setGlobalTasks(prev =>
        prev.map(task =>
          task.id === taskId
            ? {
                ...task,
                status: updatedTask.status
              }
            : task
        )
      );

      // Update stats
      loadTaskStats();
    } catch (error) {
}
  };

  const handleTaskClick = (taskId: string) => {
    router.push(`/dashboard/tasks?highlight=${taskId}`);
  };

  // Get notification timing based on config
  const getNotificationTiming = (item: Task | Reminder) => {
    const now = new Date();
    const dueDate = item.dueDate.toDate();
    const minutesUntilDue = (dueDate.getTime() - now.getTime()) / (1000 * 60);
    const hoursUntilDue = minutesUntilDue / 60;

    // Check if it's a task
    if ('priority' in item) {
      const task = item as Task;
      const priorityConfig = notificationConfig.tasks[task.priority];

      if (!priorityConfig) return null;

      for (const timeFrame of priorityConfig.timeFrames) {
        const minMinutes = timeFrame.minMinutes || (timeFrame.minHours ? timeFrame.minHours * 60 : 0);
        const maxMinutes = timeFrame.maxMinutes || (timeFrame.maxHours ? timeFrame.maxHours * 60 : Infinity);

        if (minutesUntilDue >= minMinutes && minutesUntilDue < maxMinutes) {
          return timeFrame.notification; // minutes before due date
        }
      }

      return priorityConfig.default || notificationConfig.tasks.default || 30;
    }
    // It's a reminder
    else {
      const reminder = item as Reminder;
      const reminderConfig = notificationConfig.reminders;

      for (const timeFrame of reminderConfig.timeFrames) {
        const minMinutes = timeFrame.minMinutes || (timeFrame.minHours ? timeFrame.minHours * 60 : 0);
        const maxMinutes = timeFrame.maxMinutes || (timeFrame.maxHours ? timeFrame.maxHours * 60 : Infinity);

        if (minutesUntilDue >= minMinutes && minutesUntilDue < maxMinutes) {
          return timeFrame.notification; // minutes before due date
        }
      }

      return reminderConfig.default || 30;
    }
  };

  // Check and send notifications
  const checkAndSendNotifications = () => {
    console.log('üîî Notification check started');

    if (!('Notification' in window)) {
      console.log('‚ùå Notifications not supported');
      return;
    }

    console.log('üìã Notification permission:', Notification.permission);

    if (Notification.permission !== 'granted') {
      console.log('‚ùå Notification permission not granted');
      return;
    }

    const now = new Date();
    console.log('‚è∞ Current time:', now.toLocaleTimeString());

    // Check reminders
    console.log('üìÖ Checking reminders:', upcomingReminders.length);
    upcomingReminders.forEach((reminder, index) => {
      const notificationTiming = getNotificationTiming(reminder);
      console.log(`üìù Reminder ${index + 1}: "${reminder.title}"`);
      console.log(`   Due: ${reminder.dueDate.toDate().toLocaleTimeString()}`);
      console.log(`   Notification timing: ${notificationTiming} minutes before`);

      if (!notificationTiming) {
        console.log('   ‚ùå No notification timing found');
        return;
      }

      const dueDate = reminder.dueDate.toDate();
      const notificationTime = new Date(dueDate.getTime() - notificationTiming * 60000);
      const notificationKey = `reminder-${reminder.id}`;
      const minutesUntilDue = (dueDate.getTime() - now.getTime()) / (1000 * 60);
      const minutesUntilNotification = (notificationTime.getTime() - now.getTime()) / (1000 * 60);

      console.log(`   Minutes until due: ${minutesUntilDue.toFixed(1)}`);
      console.log(`   Minutes until notification: ${minutesUntilNotification.toFixed(1)}`);
      console.log(`   Notification time: ${notificationTime.toLocaleTimeString()}`);
      console.log(`   Already sent: ${sentNotifications.has(notificationKey)}`);

      // Check if we should send notification now (within 1 minute window)
      const timeDiff = Math.abs(now.getTime() - notificationTime.getTime());
      console.log(`   Time diff from notification time: ${timeDiff / 1000} seconds`);

      // Check if we're in the notification window
      const isInNotificationWindow = timeDiff < 60000;

      // Clean up expired sent notifications (if time window has passed)
      if (timeDiff > 60000 && sentNotifications.has(notificationKey)) {
        console.log('üßπ Cleaning up expired notification tracking');
        setSentNotifications(prev => {
          const newSet = new Set(prev);
          newSet.delete(notificationKey);
          return newSet;
        });
      }

      if (isInNotificationWindow && !sentNotifications.has(notificationKey)) {
        console.log('üö® SENDING NOTIFICATION!');

        // Always show toast notification
        setToastNotification({
          id: notificationKey,
          title: 'Reminder Due Soon!',
          body: `${reminder.title} is due in ${notificationTiming} minute${notificationTiming !== 1 ? 's' : ''}`,
          timestamp: Date.now()
        });

        // Try browser notification as well
        try {
          new Notification('Reminder Due Soon!', {
            body: `${reminder.title} is due in ${notificationTiming} minute${notificationTiming !== 1 ? 's' : ''}`,
            icon: '/favicon.ico',
            tag: notificationKey
          });
          console.log('‚úÖ Browser notification sent successfully');
        } catch (error) {
          console.error('‚ùå Browser notification failed:', error);
          console.log('üçû Toast notification displayed as fallback');
        }

        setSentNotifications(prev => new Set([...prev, notificationKey]));
      } else {
        if (!isInNotificationWindow) {
          console.log('   ‚è∞ Not in notification window yet');
        } else {
          console.log('   üîî Already sent in this window');
        }
      }
    });

    // Check tasks
    console.log('üéØ Checking tasks:', upcomingTasks.length);
    upcomingTasks.forEach((task, index) => {
      const notificationTiming = getNotificationTiming(task);
      console.log(`üìã Task ${index + 1}: "${task.title}" (${task.priority})`);
      console.log(`   Due: ${task.dueDate.toDate().toLocaleTimeString()}`);
      console.log(`   Notification timing: ${notificationTiming} minutes before`);

      if (!notificationTiming) {
        console.log('   ‚ùå No notification timing found');
        return;
      }

      const dueDate = task.dueDate.toDate();
      const notificationTime = new Date(dueDate.getTime() - notificationTiming * 60000);
      const notificationKey = `task-${task.id}`;
      const minutesUntilDue = (dueDate.getTime() - now.getTime()) / (1000 * 60);
      const minutesUntilNotification = (notificationTime.getTime() - now.getTime()) / (1000 * 60);

      console.log(`   Minutes until due: ${minutesUntilDue.toFixed(1)}`);
      console.log(`   Minutes until notification: ${minutesUntilNotification.toFixed(1)}`);
      console.log(`   Notification time: ${notificationTime.toLocaleTimeString()}`);
      console.log(`   Already sent: ${sentNotifications.has(notificationKey)}`);

      // Check if we should send notification now (within 1 minute window)
      const timeDiff = Math.abs(now.getTime() - notificationTime.getTime());
      console.log(`   Time diff from notification time: ${timeDiff / 1000} seconds`);

      if (timeDiff < 60000 && !sentNotifications.has(notificationKey)) {
        const priority = task.priority.toUpperCase();
        const timeMessage = notificationTiming >= 60
          ? `${notificationTiming / 60} hour${notificationTiming / 60 !== 1 ? 's' : ''}`
          : `${notificationTiming} minute${notificationTiming !== 1 ? 's' : ''}`;

        console.log('üö® SENDING TASK NOTIFICATION!');

        // Always show toast notification
        setToastNotification({
          id: notificationKey,
          title: `${priority} Priority Task Due Soon!`,
          body: `${task.title} is due in ${timeMessage}`,
          timestamp: Date.now()
        });

        // Try browser notification as well
        try {
          new Notification(`${priority} Priority Task Due Soon!`, {
            body: `${task.title} is due in ${timeMessage}`,
            icon: '/favicon.ico',
            tag: notificationKey
          });
          console.log('‚úÖ Task browser notification sent successfully');
        } catch (error) {
          console.error('‚ùå Task browser notification failed:', error);
          console.log('üçû Toast notification displayed as fallback');
        }

        setSentNotifications(prev => new Set([...prev, notificationKey]));
      } else {
        console.log('   ‚è≥ Not time to notify yet');
      }
    });

    console.log('üîî Notification check completed');
  };

  // Setup notification system
  useEffect(() => {
    console.log('üöÄ Dashboard component mounted - setting up notifications');

    // Request notification permission
    if ('Notification' in window) {
      console.log('üì± Browser supports notifications');
      if (Notification.permission === 'default') {
        console.log('üîî Requesting notification permission...');
        Notification.requestPermission().then(permission => {
          console.log('‚úÖ Permission result:', permission);
        });
      } else {
        console.log('üìã Current permission:', Notification.permission);
      }
    } else {
      console.log('‚ùå Browser does not support notifications');
    }

    // Run notification check immediately for testing
    console.log('‚ö° Running immediate notification check...');
    checkAndSendNotifications();

    // Check for notifications every 10 seconds for testing (instead of 1 minute)
    console.log('‚è∞ Setting up notification interval (every 10 seconds for testing)');
    const notificationInterval = setInterval(() => {
      console.log('‚è±Ô∏è Interval triggered - checking notifications...');
      checkAndSendNotifications();
    }, 10000); // 10 seconds instead of 60 for faster testing

    return () => {
      console.log('üßπ Cleaning up notification interval');
      clearInterval(notificationInterval);
    };
  }, [upcomingReminders, upcomingTasks, sentNotifications]);

  // Auto-hide toast after 5 seconds
  useEffect(() => {
    if (toastNotification) {
      const timer = setTimeout(() => {
        setToastNotification(null);
      }, 5000);

      return () => clearTimeout(timer);
    }
  }, [toastNotification]);

  return (
    <div>
      {/* Toast Notification */}
      {toastNotification && (
        <div style={{
          position: 'fixed',
          top: '20px',
          right: '20px',
          background: 'var(--brand)',
          color: 'white',
          padding: '16px 20px',
          borderRadius: '8px',
          boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
          zIndex: 1000,
          maxWidth: '350px',
          animation: 'slideIn 0.3s ease-out'
        }}>
          <div style={{ fontWeight: '600', marginBottom: '4px', fontSize: '16px' }}>
            {toastNotification.title}
          </div>
          <div style={{ fontSize: '14px', opacity: 0.9 }}>
            {toastNotification.body}
          </div>
          <button
            onClick={() => setToastNotification(null)}
            style={{
              position: 'absolute',
              top: '8px',
              right: '8px',
              background: 'none',
              border: 'none',
              color: 'white',
              fontSize: '18px',
              cursor: 'pointer',
              padding: '4px',
              borderRadius: '4px'
            }}
          >
            √ó
          </button>
          {/* Auto-hide after 5 seconds */}
          <style jsx>{`
            @keyframes slideIn {
              from { transform: translateX(100%); opacity: 0; }
              to { transform: translateX(0); opacity: 1; }
            }
          `}</style>
        </div>
      )}

      {/* Welcome Section */}
      <div style={{ marginBottom: '28px' }}>
        <h1 style={{ fontSize: 'var(--fs-hero)', margin: '0 0 8px', color: 'var(--text)' }}>
          Welcome back, {user?.displayName || "Student"}!
        </h1>
        <p className="small" style={{ fontSize: '16px', color: 'var(--text-2)' }}>
          Here's what's happening with your studies today.
        </p>
      </div>

      {/* Dashboard Widgets */}
      <div style={{ display: 'grid', gap: '12px', gridTemplateColumns: 'repeat(12, 1fr)', marginBottom: '28px' }}>
        <div className="card" style={{ gridColumn: 'span 3', background: 'var(--brand-100)' }}>
          <div className="small">Total Tasks</div>
          <h3 style={{ margin: '4px 0 0', fontSize: 'var(--fs-h2)', color: 'var(--brand-700)' }}>
            {taskStats.total}
          </h3>
          <div className="small">{taskStats.dueThisWeek} due this week</div>
        </div>
        <div className="card" style={{ gridColumn: 'span 3' }}>
          <div className="small">Pending Tasks</div>
          <h3 style={{ margin: '4px 0 0', fontSize: 'var(--fs-h2)', color: 'var(--text-2)' }}>
            {taskStats.pending}
          </h3>
          <div className="small">{taskStats.overdue} overdue</div>
        </div>
        <div className="card" style={{ gridColumn: 'span 3' }}>
          <div className="small">Active Subjects</div>
          <h3 style={{ margin: '4px 0 0', fontSize: 'var(--fs-h2)', color: 'var(--text)' }}>
            {subjects.length}
          </h3>
          <div className="small">{subjects.filter(s => s.isActive).length} active</div>
        </div>
        <div className="card" style={{ gridColumn: 'span 3' }}>
          <div className="small">Completed Tasks</div>
          <h3 style={{ margin: '4px 0 0', fontSize: 'var(--fs-h2)', color: 'var(--ok)' }}>
            {taskStats.completed}
          </h3>
          <div className="small">
            {taskStats.total > 0 ? Math.round((taskStats.completed / taskStats.total) * 100) : 0}% completion rate
          </div>
        </div>
      </div>

      {/* Timer Widget */}
      <div style={{ marginBottom: '28px' }}>
        <TimerWidget />
      </div>

      {/* Main Content Grid */}
      <div style={{ display: 'grid', gap: '16px', gridTemplateColumns: 'repeat(12, 1fr)' }}>

        {/* Calendar */}
        <div style={{ gridColumn: 'span 8' }}>
          <Calendar userId={user?.userId || ''} />
        </div>

        {/* Quick Actions & Progress */}
        <div className="card" style={{ gridColumn: 'span 4' }}>
          <h3 style={{ fontSize: 'var(--fs-h2)', margin: '0 0 14px', color: 'var(--text)' }}>Quick Actions</h3>
          <div className="hr"></div>

          <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
            <a href="/dashboard/tasks/new" className="btn" style={{ justifyContent: 'center' }}>
              Create Task
            </a>
            <a href="/dashboard/subjects/new" className="btn subtle" style={{ justifyContent: 'center' }}>
              Add Subject
            </a>
            <button
              onClick={() => setIsReminderModalOpen(true)}
              className="btn ghost"
              style={{ justifyContent: 'center' }}
            >
              Set Reminder
            </button>
          </div>

          <div className="hr" style={{ margin: '20px 0' }}></div>

          <h4 style={{ fontSize: 'var(--fs-h3)', margin: '0 0 10px', color: 'var(--text)' }}>Your Progress</h4>
          <div style={{ height: '10px', background: 'var(--border)', borderRadius: '999px', overflow: 'hidden', marginBottom: '6px' }}>
            <div style={{ display: 'block', height: '100%', width: `${Math.min(100, (subjects.length / 5) * 100)}%`, background: 'var(--brand)', borderRadius: '999px' }}></div>
          </div>
          <div className="small">
            {subjects.length === 0 ? 'No subjects yet' : `${subjects.length} subject${subjects.length !== 1 ? 's' : ''} added`}
          </div>
        </div>

        {/* Upcoming Tasks */}
        <div className="card" style={{ gridColumn: 'span 6' }}>
          <div className="row">
            <h3 style={{ fontSize: 'var(--fs-h2)', margin: '0 0 14px', color: 'var(--text)' }}>Upcoming Tasks</h3>
            <span className="right badge brand">
              {upcomingTasks.length > 0 ? `${upcomingTasks.length} Active` : 'None'}
            </span>
          </div>
          <div className="hr"></div>

          {isLoadingTasks ? (
            <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-2)' }}>
              Loading tasks...
            </div>
          ) : upcomingTasks.length > 0 ? (
            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
              {upcomingTasks.slice(0, 5).map((task) => (
                <div
                  key={task.id}
                  onClick={() => handleTaskClick(task.id)}
                  style={{ cursor: 'pointer', borderRadius: '8px', transition: 'background-color 0.2s' }}
                  onMouseEnter={(e) => e.currentTarget.style.backgroundColor = 'var(--hover)'}
                  onMouseLeave={(e) => e.currentTarget.style.backgroundColor = 'transparent'}
                >
                  <TaskCard
                    task={task}
                    onToggleComplete={handleTaskToggleComplete}
                    compact={true}
                    showActions={false}
                  />
                </div>
              ))}
            </div>
          ) : (
            <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-2)' }}>
              <div style={{ fontSize: '24px', marginBottom: '8px', opacity: 0.3 }}>üìã</div>
              <div style={{ fontSize: '14px' }}>No upcoming tasks</div>
              <a
                href="/dashboard/tasks/new"
                className="btn ghost"
                style={{ fontSize: '12px', marginTop: '8px' }}
              >
                Create your first task
              </a>
            </div>
          )}
        </div>

        {/* Upcoming Reminders */}
        <div className="card" style={{ gridColumn: 'span 6' }}>
          <div className="row">
            <h3 style={{ fontSize: 'var(--fs-h2)', margin: '0 0 14px', color: 'var(--text)' }}>Upcoming Reminders</h3>
            <span className="right badge brand">
              {upcomingReminders.length > 0 ? `${upcomingReminders.length} Active` : 'None'}
            </span>
          </div>
          <div className="hr"></div>

          {isLoadingReminders ? (
            <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-2)' }}>
              Loading reminders...
            </div>
          ) : upcomingReminders.length > 0 ? (
            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>
              {upcomingReminders.slice(0, 3).map((reminder) => (
                <div key={reminder.id} className="row" style={{ gap: '10px' }}>
                                    <div style={{ flex: 1 }}>
                    <b style={{ color: 'var(--text)' }}>{reminder.title}</b>
                    <div className="small">
                      Due {reminder.dueDate.toDate().toLocaleDateString()} ‚Ä¢ {reminder.dueDate.toDate().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit', hour12: true })}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-2)' }}>
              <div style={{ fontSize: '24px', marginBottom: '8px', opacity: 0.3 }}>üìÖ</div>
              <div style={{ fontSize: '14px' }}>No upcoming reminders</div>
              <button
                onClick={() => setIsReminderModalOpen(true)}
                className="btn ghost"
                style={{ fontSize: '12px', marginTop: '8px' }}
              >
                Create your first reminder
              </button>
            </div>
          )}
        </div>

        {/* Subject Overview */}
        <div className="card" style={{ gridColumn: 'span 6' }}>
          <div className="row">
            <h3 style={{ fontSize: 'var(--fs-h2)', margin: '0 0 14px', color: 'var(--text)' }}>Subject Overview</h3>
            <span className="right badge ok">{subjects.length} Active</span>
          </div>
          <div className="hr"></div>

          {isLoadingData ? (
            <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-2)' }}>
              Loading subjects...
            </div>
          ) : subjects.length > 0 ? (
            <div style={{ display: 'grid', gap: '10px', gridTemplateColumns: 'repeat(2, 1fr)' }}>
              {subjects.slice(0, 4).map((subject) => (
                <div key={subject.id} className="row" style={{ gap: '8px' }}>
                  <span
                    className="badge"
                    style={{
                      background: `${subject.color}15`,
                      color: subject.color,
                      border: `1px solid ${subject.color}30`
                    }}
                  >
                    {subject.code || subject.name}
                  </span>
                  <div className="small">
                    Active
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div style={{ textAlign: 'center', padding: '20px', color: 'var(--text-2)' }}>
              <div style={{ fontSize: '20px', marginBottom: '8px' }}>üìö</div>
              <div>No subjects yet</div>
              <div className="small">Add your first subject to get started</div>
            </div>
          )}
        </div>
      </div>

      {/* Reminder Modal */}
      <ReminderModal
        isOpen={isReminderModalOpen}
        onClose={() => setIsReminderModalOpen(false)}
        onSuccess={loadUpcomingReminders}
      />
    </div>
  );
}